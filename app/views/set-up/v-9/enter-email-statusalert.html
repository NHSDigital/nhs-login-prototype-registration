{% extends 'layouts/layout-cookie-banner.html' %}
{% extends 'layouts/layout.html' %}

{% from 'button/macro.njk' import button %}
{% from 'back-link/macro.njk' import backLink %}

{% block pageTitle %}
Enter your email address
{% endblock %}

{% block content %}

<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds nhsuk-u-margin-bottom-4">

  <div class="nhsuk-alert nhsuk-alert--warning nhsuk-alert--icon">
<svg class="nhsuk-icon nhsuk-icon__warning nhsuk-alert__icon" fill="none" aria-hidden="true" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;">
  <g>
    <g>
      <path d="M501.609,384.603L320.543,51.265c-13.666-23.006-37.802-36.746-64.562-36.746c-26.76,0-50.896,13.74-64.562,36.746
        c-0.103,0.176-0.19,0.352-0.293,0.528L10.662,384.076c-13.959,23.491-14.223,51.702-0.719,75.457
        c13.535,23.769,37.919,37.948,65.266,37.948h360.544c27.347,0,52.733-14.179,66.267-37.948
        C515.524,435.779,515.261,407.566,501.609,384.603z M225.951,167.148c0-16.586,13.445-30.03,30.03-30.03
        c16.586,0,30.03,13.445,30.03,30.03v120.121c0,16.584-13.445,30.03-30.03,30.03s-30.03-13.447-30.03-30.03V167.148z
        M255.981,437.421c-24.839,0-45.046-20.206-45.046-45.046c0-24.839,20.206-45.045,45.046-45.045
        c24.839,0,45.045,20.206,45.045,45.045C301.027,417.214,280.821,437.421,255.981,437.421z"></path>
    </g>
  </g>
</svg>
  <h3 class="nhsuk-u-visually-hidden">Warning:</h3>
  <p class="nhsuk-u-font-weight-bold">There is an issue that may affect your experience with NHS login.<br>
You can continue, or try again later if you have problems.</p>
</div>

    <form action="register-create-password" autocomplete="on">
      <fieldset class="nhsuk-fieldset">
        <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--l">
          <h1 class="nhsuk-heading-l">
            Enter your email address
          </h1>
        </legend>

        <div class="nhsuk-form-group">
          <label class="nhsuk-label" for="emailAddress">
            Email address
          </label>
          <input class="nhsuk-input nhsuk-input--width-20" id="emailAddress" name="emailAddress"
            value="{{ data['emailAddress'] }}" type="email">
        </div>
        <a>
          <button data-redirect="register-create-password" class="nhsuk-button full-width"
            id="button--save">Continue</button>
        </a>

        <div class="nhsuk-inset-text nhsuk-u-margin-top-1 nhsuk-u-margin-bottom-5">
          <span class="nhsuk-u-visually-hidden">Information: </span>
          <h2>What is NHS login?</h2>
          <p>You can use your NHS login to access health websites and apps that have the NHS login button. If you do not have an NHS login, enter your email address to set one up.</p>
        </div>
      </fieldset>
      <div class="nhsuk-warning-callout  nhsuk-u-margin-top-3">
        <h3 class="nhsuk-warning-callout__label">Coronavirus (COVID-19)</h3>
        <p>For health information and advice, read <a href="#" class="nhsuk-link">NHS guidance about Coronavirus</a></p>
      </div>
    </form>

    {% if data['devMode'] %}
    <details class="nhsuk-details dev-mode" role="group">
      <summary class="nhsuk-details__summary" role="button" aria-controls="details-content-0" aria-expanded="true">
        <span class="nhsuk-details__summary-text">
          Continue with testing scenario
        </span>
      </summary>
      <div class="nhsuk-details__text">
        <p>Routes</p>
        <ul>
          <li>
            <a href="login-enter-password">User has account</a>
          </li>
          <li>
            <a href="register-account-creation-alert">Account creation alert screen</a>
          </li>
          <li>
            <a href="what-you-need">What you need</a>
          </li>
        </ul>
        <p>Errors</p>
        <ul>
          <li>
            <a href="../errors/error-email-no-input">No input</a>
          </li>
          <li>
            <a href="../errors/error-email-regex">Incorrect format</a>
          </li>
          <li>
            <a href="../errors/error-session-timeout">Session timeout</a>
          </li>
          <li>
            <a href="../errors/error-invalid-session">Invalid Session</a>
          </li>
          <li>
            <a href="../errors/error-client-not-found">Client not found</a>
          </li>
          <li>
            <a href="../errors/error-404">404</a>
          </li>
          <li>
            <a href="../errors/error-service-busy">Service too busy</a>
          </li>
          <li>
            <a href="../errors/error-lock-OTP-attempts-exceeded">Account lock: OTP attempts exceeded (< 5 times)</a>
          </li> 
          <li>
            <a href="../errors/error-lock-OTP-incorrect-attempts-exceeded">Account lock: OTP incorrect attempts exceeded (> 5 times)</a>
          </li>
          <li>
            <a href="../errors/error-lock-OTP-requests-exceeded">Account lock: OTP requests exceeded</a>
          </li>
          <li>
            <a href="../errors/error-lock-password-attempts-exceeded">Account lock: Password attempts exceeded</a>
          </li>
          <li>
            <a href="../errors/error-lock-p5-p9-nhs-no-mismatch">Account lock: P5 to P9 - NHS Number mismatch</a>
          </li>
          <li>
            <a href="../errors/error-lock-we-cannot-log-you-in">Account lock: We cannot log you in</a>
          </li>
          <li>
            <a href="../errors/error-login-disabled">Disabled NHS login</a>
          </li>
        </ul>
      </div>
    </details>
    {% endif %}
  </div>
</div>

<script type="text/javascript">
  submitSpinner()

  function buttonClicked(target) {
    target.setAttribute('disabled', 'disabled')
    target.className += ' button--save'
    setTimeout(function () {
      window.location.href = target.dataset.redirect;
    }, 2000)
  }

  function submitSpinner() {
    var selects = document.getElementById('button--save')
    selects.addEventListener('click', function (event) {
      event.preventDefault()
      if (selects.getAttribute('disabled') === 'disabled') {
        console.log('already clicked')
      } else {
        event.preventDefault()
        console.log(selects.getAttribute('disabled'))
        buttonClicked(selects)
      }
    })
  }
</script>

{% endblock %}